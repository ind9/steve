{
  "id": "{{.DEPLOY_ENV}}.steve",
  "cpus": {{.Env.CPU}},
  "mem": {{.Env.MEM}},
  "instances": {{.Env.INSTANCES}},
  "backoffSeconds": 1,
  "backoffFactor": 1.01,
  "maxLaunchDelaySeconds": 300,
  "ports": [
    0, 0
  ],
  "cmd": "s3cmd get s3://indix-build-artifacts/{{.Env.GO_PIPELINE_NAME}}/push-s3/push/{{.Env.GO_PIPELINE_COUNTER}}.{{.Env.GO_STAGE_COUNTER}}/steve-server/service_package/service_pack/core-service.tgz && tar -xvzf core-service.tgz && bash bin/deploy.sh $PORT0 $PORT1",
  "uris": [],
  "constraints": [
    ["lifecycle", "LIKE", "{{if .DEPLOY_ENV | eq "production "}}ondemand{{else}}spot{{end}}"],
    ["app", "LIKE", "apps-{{.DEPLOY_ENV}}"]
  ],
  "upgradeStrategy": {
  "minimumHealthCapacity": 0.9,
  "maximumOverCapacity": 0.5
  },
  "labels": {
    {{if .Env.ROUTER_HOSTS}}"router.hosts": "{{ .Env.ROUTER_HOSTS }}"{{end}}
  },
  "env": {
    "DB_HOST": "{{ .Env.DB_HOST }}",
    "DB_USER_PWD": "{{ .Env.DB_USER_PWD }}",
    "DB_USER_NAME": "{{ .Env.DB_USER_NAME }}"
  },
  "healthChecks": [{
    "protocol": "HTTP",
    "portIndex": 1,
    "path": "/admin/healthcheck",
    "gracePeriodSeconds": 240,
    "intervalSeconds": 60,
    "maxConsecutiveFailures": 3,
    "timeoutSeconds": 20
  }]
}
